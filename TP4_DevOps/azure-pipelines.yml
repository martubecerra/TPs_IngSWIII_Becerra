# Pipeline CI para TP4 DevOps
# Configurado para ejecutarse en un agente Self-Hosted

trigger:
  - main

pool:
  name: 'SelfHosted'

stages:
- stage: CI
  jobs:
  - job: BuildBackend
    steps:
    - checkout: self
      path: s/TP4_DevOps
    - script: |
        node --version
        npm --version
        cd $(Build.SourcesDirectory)/TP4_DevOps/back
        npm ci
        npm test
      displayName: 'Build and Test Backend'
    - task: PublishPipelineArtifact@1
      inputs:
        targetPath: '$(Build.SourcesDirectory)/TP4_DevOps/back'
        artifact: 'backend-dist'

  - job: BuildFrontend
    steps:
    - checkout: self
      path: s/TP4_DevOps
    - script: |
        node --version
        npm --version
        cd $(Build.SourcesDirectory)/TP4_DevOps/front
        npm ci
        npm run build
      displayName: 'Build Frontend'
    - task: PublishPipelineArtifact@1
      inputs:
        targetPath: '$(Build.SourcesDirectory)/TP4_DevOps/front/build'
        artifact: 'frontend-dist'